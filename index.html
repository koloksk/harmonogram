<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Harmonogram MUP - Nieoficjalny Plan Zajƒôƒá</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Nieoficjalny harmonogram zajƒôƒá MUP. PrzeglƒÖdaj plan zajƒôƒá w formie kalendarza, filtruj wydarzenia i eksportuj do w≈Çasnego kalendarza." />
  <meta name="keywords" content="MUP, harmonogram, plan zajƒôƒá, kalendarz, uniwersytet, nieoficjalny plan" />
  <meta name="author" content="koloksk" />
  <meta name="robots" content="index, follow" />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Harmonogram MUP - Nieoficjalny Plan Zajƒôƒá" />
  <meta property="og:description" content="Nieoficjalny harmonogram zajƒôƒá MUP. PrzeglƒÖdaj plan zajƒôƒá w formie kalendarza, filtruj wydarzenia i eksportuj do w≈Çasnego kalendarza." />
  <meta property="og:site_name" content="Harmonogram MUP" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Harmonogram MUP - Nieoficjalny Plan Zajƒôƒá" />
  <meta name="twitter:description" content="Nieoficjalny harmonogram zajƒôƒá MUP. PrzeglƒÖdaj plan zajƒôƒá w formie kalendarza." />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" type="image/png" href="./logo.png">
  <link rel="apple-touch-icon" href="./logo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MUP">
  <meta name="theme-color" content="#0b1020">
  <meta name="google-site-verification" content="k25xdebJfW0XlcfMFC-weLROJRpaZQAuEyWCgrUtxSw" />
  
  <!-- Service Worker - rejestracja z auto-update -->
  <script>
    if ('serviceWorker' in navigator) {
      let refreshing = false;
      
      // Wykryj gdy nowy SW przejmuje kontrolƒô
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (refreshing) return;
        refreshing = true;
        console.log('üîÑ Nowy Service Worker aktywny - od≈õwie≈ºam stronƒô...');
        window.location.reload();
      });
      
      navigator.serviceWorker.register('./service-worker.js')
        .then(reg => {
          console.log('‚úÖ Service Worker zarejestrowany');
          
          // Sprawd≈∫ aktualizacje co minutƒô
          setInterval(() => {
            reg.update();
          }, 60000);
          
          // Je≈õli jest nowy SW czekajƒÖcy, poka≈º powiadomienie
          if (reg.waiting) {
            showUpdateNotification(reg.waiting);
          }
          
          reg.addEventListener('updatefound', () => {
            const newWorker = reg.installing;
            console.log('üÜï Znaleziono nowƒÖ wersjƒô aplikacji...');
            
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                showUpdateNotification(newWorker);
              }
            });
          });
        })
        .catch(err => console.error('‚ùå B≈ÇƒÖd rejestracji SW:', err));
    }
    
    function showUpdateNotification(worker) {
      // Sprawd≈∫ czy ju≈º istnieje powiadomienie
      if (document.getElementById('update-notification')) return;
      
      const notification = document.createElement('div');
      notification.id = 'update-notification';
      notification.className = 'update-notification';
      notification.innerHTML = `
        <div class="update-icon">üÜï</div>
        <div class="update-content">
          <div class="update-title">Dostƒôpna aktualizacja!</div>
          <div class="update-desc">Kliknij aby za≈Çadowaƒá nowƒÖ wersjƒô</div>
        </div>
        <button class="update-close" aria-label="Zamknij">√ó</button>
      `;
      
      // Delegacja event√≥w
      notification.addEventListener('click', (e) => {
        if (e.target.classList.contains('update-close')) {
          notification.remove();
        } else {
          worker.postMessage({ type: 'SKIP_WAITING' });
          notification.remove();
        }
      });
      
      document.body.appendChild(notification);
      
      // Auto-usu≈Ñ po 10 sekundach
      setTimeout(() => {
        if (notification.parentNode) {
          notification.style.opacity = '0';
          setTimeout(() => notification.remove(), 300);
        }
      }, 10000);
    }
  </script>
  
  <!-- Zewnƒôtrzny plik CSS -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Harmonogram</h1>
    <div style="display: flex; align-items: center; gap: 12px;">
      <div class="seg">
        <button id="viewMonth" aria-pressed="true" data-view="dayGridMonth">MiesiƒÖc</button>
        <button id="viewWeek" aria-pressed="false" data-view="timeGridWeek">Tydzie≈Ñ</button>
        <button id="viewDay" aria-pressed="false" data-view="timeGridDay">Dzie≈Ñ</button>
      </div>
      <button id="helpBtn" class="help-btn" title="ZarzƒÖdzaj harmonogramami" aria-label="ZarzƒÖdzaj harmonogramami">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
      </button>
    </div>
  </header>

  <main>
    <section class="active-schedule" id="activeScheduleBanner" aria-live="polite">
      <div class="active-schedule-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
          <circle cx="8" cy="15" r="1"></circle>
          <circle cx="12" cy="15" r="1"></circle>
          <circle cx="16" cy="15" r="1"></circle>
        </svg>
      </div>
      <div class="active-schedule-content">
        <p class="active-schedule-label">Aktywny harmonogram</p>
        <p class="active-schedule-name" id="activeScheduleName">≈Åadowanie danych‚Ä¶</p>
        <div class="active-schedule-meta">
          <span class="active-schedule-chip active-schedule-chip-status" id="activeScheduleStatus">Status: ‚Äî</span>
          <span class="active-schedule-chip" id="activeScheduleEvents">Wydarzenia: ‚Äî</span>
          <span class="active-schedule-chip" id="activeScheduleSource">≈πr√≥d≈Ço: ‚Äî</span>
        </div>
      </div>
      <button class="active-schedule-manage" id="activeScheduleManage" type="button" aria-label="Zmie≈Ñ aktywny harmonogram">
        ZarzƒÖdzaj
      </button>
    </section>
    <aside>
      <!-- Kafelek nastƒôpujƒÖcych zajƒôƒá -->
      <div class="next-card" id="nextCard" aria-live="polite">
        <div class="next-header">
          <div class="next-status" id="nextStatus">Wyszukiwanie najbli≈ºszych zajƒôƒá‚Ä¶</div>
          <span class="next-badge" id="nextBadge" style="display:none">Zdalnie</span>
        </div>
        <div class="next-title" id="nextTitle">‚Äî</div>
        <div class="next-time"><span id="nextRange">‚Äî</span> <span class="next-room" id="nextRoom"></span></div>
        <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="Postƒôp zajƒôƒá">
          <div class="bar" id="nextProgress"></div>
        </div>
      </div>

      <div class="section-title">Filtry</div>
      <div class="filters">
        <div class="group">
          <label for="program">Kierunek studi√≥w</label>
          <select id="program"><option value="">Wszystkie</option></select>
        </div>
        <div class="group">
          <label for="type">Rodzaj zajƒôƒá</label>
          <select id="type"><option value="">Wszystkie</option></select>
        </div>
        <div class="group">
          <label for="room">Sala</label>
          <select id="room"><option value="">Wszystkie</option></select>
        </div>
        <div class="group">
          <label for="lecturer">Wyk≈Çadowca</label>
          <select id="lecturer"><option value="">Wszyscy</option></select>
        </div>
        <button id="reset" class="reset">Wyczy≈õƒá filtry</button>
      </div>

      <!-- Mapa kampusu -->
      <div class="campus-map">
        <div class="campus-map-title">Mapa Kampusu</div>
        <div class="map-container">
          <svg class="map-svg" viewBox="0 0 896 1152" xmlns="http://www.w3.org/2000/svg">
            <!-- T≈Ço - zdjƒôcie kampusu -->
            <image class="map-bg" href="./campus-map.png" x="0" y="0" width="896" height="1152" preserveAspectRatio="xMidYMid slice"/>
            
            <!-- CsH - Collegium sub Horologio (g√≥rny budynek w kszta≈Çcie T) -->
            <polygon 
              class="building-area" 
              data-building="csh" 
              data-name="Collegium sub Horologio"
              points="471,154 372,186 342,118 346,89 270,108 314,205 215,245 235,306 453,215 490,216">
              <title>Collegium sub Horologio (CsH)</title>
            </polygon>
            
            <!-- CP - Collegium Primum (≈õrodkowy budynek) -->
            <polygon 
              class="building-area" 
              data-building="cp" 
              data-name="Collegium Primum"
              points="559,457 458,491 447,485 430,502 337,537 353,589 573,512">
              <title>Collegium Primum (CP)</title>
            </polygon>
            
            <!-- CI - Collegium Inventorum (dolny budynek) -->
            <polygon 
              class="building-area" 
              data-building="ci" 
              data-name="Collegium Inventorum"
              points="617,648 552,673 611,833 574,858 584,882 626,875 684,1031 749,1003">
              <title>Collegium Inventorum (CI)</title>
            </polygon>
          </svg>
          
          <!-- Etykiety budynk√≥w (tooltips) -->
          <div class="building-label" id="label-csh">Collegium sub Horologio (CsH)</div>
          <div class="building-label" id="label-cp">Collegium Primum (CP)</div>
          <div class="building-label" id="label-ci">Collegium Inventorum (CI)</div>
        </div>
      </div>

      <div class="stats">
        <div class="card"><h3>≈ÅƒÖcznie</h3><div class="value" id="statTotal">0</div></div>
        <div class="card"><h3>Widocznych</h3><div class="value" id="statVisible">0</div></div>
      </div>

      <div class="export">
        <button id="exportGoogle" class="gcal-btn" aria-label="Eksportuj do Google Kalendarza" title="Pobierz plik .ics z aktualnie przefiltrowanymi wydarzeniami">
          <span class="gcal-logo" aria-hidden="true">
            <!-- Prosty, w≈Çasny znak w kolorach Google -->
            <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
              <path fill="#EA4335" d="M24 9.5c3.38 0 6.44 1.18 8.85 3.13l6.63-6.63C35.6 2.25 30.12 0 24 0 14.6 0 6.45 5.4 2.55 13.2l7.92 6.15C12.16 13.5 17.61 9.5 24 9.5z"/>
              <path fill="#4285F4" d="M46.5 24.5c0-1.55-.15-3.05-.44-4.5H24v9h12.7c-.55 2.95-2.19 5.45-4.66 7.13l7.15 5.57C43.93 37.5 46.5 31.42 46.5 24.5z"/>
              <path fill="#FBBC05" d="M10.47 19.35l-7.92-6.15C.9 16.16 0 20.01 0 24c0 3.9.86 7.61 2.4 10.9l8.07-6.22C9.7 26.9 9.3 25.49 9.3 24c0-1.63.43-3.16 1.17-4.65z"/>
              <path fill="#34A853" d="M24 48c6.06 0 11.16-2 14.9-5.4l-7.15-5.57c-2.04 1.38-4.66 2.2-7.75 2.2-6.4 0-11.86-4.03-13.87-9.61l-8.07 6.22C6.88 43.07 14.7 48 24 48z"/>
            </svg>
          </span>
          <span>Importuj do Google Kalendarza</span>
        </button>
        <div class="export-hint">Pobierze plik .ics z obecnie przefiltrowanymi wydarzeniami. Nastƒôpnie zaimportuj go w Google Kalendarzu.</div>
      </div>
    </aside>
    <section id="calendar"></section>
  </main>

  <div id="tooltip" class="tooltip" style="display:none; opacity: 0;"></div>

  <!-- Modal zarzƒÖdzania harmonogramami -->
  <div id="scheduleModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          ZarzƒÖdzaj harmonogramami
        </h2>
        <button class="modal-close" id="modalClose" aria-label="Zamknij">&times;</button>
      </div>
      <div class="modal-body">
        <div id="scheduleListContainer"></div>
        
        <div class="add-schedule-section">
          <h3 class="add-schedule-title">Dodaj nowy harmonogram</h3>
          
          <!-- Dodaj z pliku -->
          <div class="file-input-wrapper">
            <label for="fileInput" class="file-input-label" id="fileInputLabel">
              <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              <span id="fileInputText">Wybierz plik JSON lub XLSX</span>
            </label>
            <input type="file" id="fileInput" class="file-input" accept=".json,.xlsx,.xlsm" />
          </div>
          
          <!-- Separator LUB -->
          <div style="text-align: center; margin: 20px 0; color: rgba(255,255,255,0.5); font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">
            lub
          </div>
          
          <!-- Dodaj z URL -->
          <div class="url-input-wrapper">
            <div style="margin-bottom: 10px;">
              <label for="urlInput" style="display: block; font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 8px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                </svg>
                Dodaj z URL
              </label>
              <div style="display: flex; gap: 8px;">
                <input 
                  type="text" 
                  id="urlInput" 
                  placeholder="https://uczelnia.edu.pl/harmonogram.xlsx"
                  style="flex: 1; padding: 10px 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white; font-size: 13px; font-family: 'Inter', sans-serif;"
                />
                <button 
                  id="addUrlBtn" 
                  style="padding: 10px 20px; background: linear-gradient(135deg, var(--accent) 0%, #667eea 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; white-space: nowrap; font-size: 13px; transition: transform 0.2s, box-shadow 0.2s;"
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(118, 75, 235, 0.4)';"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
                >
                  Dodaj
                </button>
              </div>
            </div>
            <div style="font-size: 11px; color: rgba(255,255,255,0.5); margin-top: 6px;">
              üí° Wspierane formaty: .xlsx, .xlsm, .json
            </div>
          </div>
        </div>

        <!-- O aplikacji -->
        <div class="about-section">
          <h3 class="about-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            O aplikacji
          </h3>
          <div class="about-content">
            <div class="about-item">
              <div class="about-label">Wersja</div>
              <div class="about-value">1.0.0</div>
            </div>
            <div class="about-item">
              <div class="about-label">Autor</div>
              <div class="about-value">koloksk</div>
            </div>
            <div class="about-item">
              <div class="about-label">Technologie</div>
              <div class="about-value">HTML ‚Ä¢ CSS ‚Ä¢ JavaScript ‚Ä¢ FullCalendar</div>
            </div>
            <div class="about-links">
              <a href="https://github.com/koloksk/harmonogram" target="_blank" rel="noopener noreferrer" class="about-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                <span>Kod ≈∫r√≥d≈Çowy</span>
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.5;">
                  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                  <polyline points="15 3 21 3 21 9"></polyline>
                  <line x1="10" y1="14" x2="21" y2="3"></line>
                </svg>
              </a>
              <a href="https://github.com/koloksk/harmonogram/issues" target="_blank" rel="noopener noreferrer" class="about-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="8" x2="12" y2="12"></line>
                  <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                <span>Zg≈Ço≈õ problem</span>
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.5;">
                  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                  <polyline points="15 3 21 3 21 9"></polyline>
                  <line x1="10" y1="14" x2="21" y2="3"></line>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Biblioteki zewnƒôtrzne -->
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.15/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.15/locales-all.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.15/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.15/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>

  <!-- Aplikacja - modu≈Çy ES6 -->
  <script type="module" src="js/main.js"></script>
  
  <!-- Kod aplikacji jest teraz w modu≈Çach ES6 (katalog /js/) -->
  <!-- Je≈õli potrzebujesz dodaƒá kod specyficzny dla index.html, dodaj go poni≈ºej -->
  <script type="module">
    // Kod aplikacji przeniesiony do modu≈Ç√≥w w /js/
    // main.js automatycznie inicjalizuje ca≈ÇƒÖ aplikacjƒô
  </script>
      

</body>
</html>